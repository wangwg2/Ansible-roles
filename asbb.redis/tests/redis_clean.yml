# file: redis_clean.yml
---
- name: stop redis services
  service:
    name: "{{item.name}}_{{item.port}}"
    state: stopped
    enabled: no
  with_items: "{{redis_installs}}"
  ignore_errors: yes

- name: clean /etc/systemd/system/redis_*.service sentinel_*.service
  file:
    path: "/etc/systemd/system/{{item.name}}_{{item.port}}.service"
    state: absent
  with_items: "{{redis_installs}}"

- name: clean /opt/data/redis/{{redis_port}}
  file:
    path: "/opt/data/redis/{{item.port}}"
    state: absent
  with_items: "{{redis_installs}}"

- name: reload systemd daemon
  command: systemctl daemon-reload